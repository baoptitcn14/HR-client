<div class="container-fluid">
  <!-- <app-page-heading title="{{ title }}" description="{{ description }}"></app-page-heading> -->

  <div id="create-manual-form">
    <div class="row">
      <div class="col-12 col-lg-3">
        <p-tabView
          [styleClass]="'tabview-custom'"
          [activeIndex]="activeTab"
          (activeIndexChange)="setTabActive($event)"
        >
          <p-tabPanel header="Các thành phần">
            <div class="d-flex flex-column gap-2">
              @if(showDropdownNganhNghe) {
              <!-- chon nganh -->
              <div
                class="d-flex flex-column gap-2 rounded shadow-sm bg-light border p-3"
              >
                <label class="fw-bold">Chọn ngành</label>

                <p-treeSelect
                  [filter]="true"
                  class="w-100"
                  containerStyleClass="w-100"
                  [(ngModel)]="selectedNganhNghe"
                  [options]="dsNganhNghe"
                  placeholder="Chọn một ngành nghề"
                />
              </div>
              }
              <!-- list -->
              <div
                class="pick-lish-components bg-light shadow-sm rounded border"
              >
                <div
                  class="list-component"
                  [cdkDropListConnectedTo]="viewList"
                  cdkDropList
                  cdkDropListSortingDisabled
                  [cdkDropListData]="groupComponent"
                >
                  @for (item of groupComponent; track item.id) {
                  <div
                    class="p-2 rounded shadow-sm bg-white component"
                    cdkDrag
                    (cdkDragStarted)="onDragStart(item)"
                  >
                    {{ item.label }}
                  </div>
                  }
                </div>
              </div>

              <!-- <app-components
                [cdkDropListConnectedTo]="dsNhomId"
                (dragStartEvent)="onDragStart($event)"
              ></app-components> -->

              <app-standard-components
                [cdkDropListConnectedTo]="dsNhomId"
                (dragStartEvent)="onDragStart($event)"
              ></app-standard-components>
            </div>
          </p-tabPanel>
          <p-tabPanel header="Thuộc tính">
            <app-properties-view
              (onDeleteEvent)="deleteThanhPhan($event)"
              [field]="selectedThanhPhan"
            ></app-properties-view>
          </p-tabPanel>
        </p-tabView>
      </div>

      <div class="col-12 col-lg-9">
        <p-toolbar [styleClass]="'p-toolbar-custom'">
          <div class="p-toolbar-group-start">
            <h2>Giao diện</h2>
          </div>

          <div class="p-toolbar-group-center">
            <div class="devices d-flex gap-3">
              @for (thietBi of dsThietBiHienThi; track thietBi.value;) {
              <p-button
                [outlined]="true"
                (click)="thietBiHienThi = thietBi.value"
                [icon]="thietBi.icon"
                [rounded]="true"
                [text]="true"
                [raised]="true"
                [severity]="
                  thietBi.value == thietBiHienThi ? 'primary' : 'secondary'
                "
              />
              }
            </div>
          </div>

          <div class="p-toolbar-group-end">
            <p-button
              label="Cập nhật giao diện"
              severity="info"
              [outlined]="true"
              [raised]="true"
              [disabled]="loadingButtonSave"
              (click)="save()"
            />
          </div>
        </p-toolbar>

        <!-- <div class="container-fluid"> -->
        <div
          [ngClass]="{
            desktop: thietBiHienThi === maThietBi.DESKTOP,
            tablet: thietBiHienThi === maThietBi.TABLET,
            mobile: thietBiHienThi === maThietBi.MOBILE
          }"
          class="main-content mx-auto row row-gap-3 g-0 flex-wrap shadow-sm bg-light border rounded"
          #viewList="cdkDropList"
          cdkDropListGroup
          cdkDropList
          cdkDropListOrientation="mixed"
          [cdkDropListData]="dsThanhPhanDangCo"
          (cdkDropListDropped)="drop($event)"
        >
          @for (item of dsThanhPhanDangCo; track item._key; let i = $index) {

          <!-- GROUP -->
          <ng-container *ngIf="item.inputType === 'group'">
            <section
              (click)="onSelectThanhPhan(item, $event)"
              class="section-group d-flex flex-column gap-3 _component col-{{
                thietBiHienThi === maThietBi.DESKTOP
                  ? 'lg-'
                  : thietBiHienThi === maThietBi.TABLET
                  ? 'md-'
                  : ''
              }}{{ item._css.responsive[thietBiHienThi] }}"
              cdkDrag
              (cdkDragStarted)="onDragStart(item)"
              [class.selected]="item._isSelected"
            >
              <!-- label group -->
              <div
                *ngIf="item.label"
                class="section-group__header d-flex align-items-start gap-3"
              >
                <i
                  class="pi pi-{{ item._css.label.icon }}"
                  [style.color]="item._css.label.iconColor"
                  *ngIf="item._css.label.icon"
                ></i>

                <h3
                  class="section-group__title m-0"
                  [style.color]="item._css.label.color"
                  [style.font-size.px]="item._css.label.fontSize"
                >
                  {{ item.label }}
                  <code class="fw-bold fs-6 text-primary user-select-all">{{
                    item._key
                  }}</code>

                  <!-- icon edit -->
                  <i
                    class="pi pi-pencil text-danger _component-icon-edit"
                    [class.selected]="item._isSelected"
                  ></i>
                </h3>
              </div>

              <div
                id="{{ item._key }}"
                class="section-group__content container-fluid"
                cdkDropList
                [cdkDropListData]="item._listChild"
                cdkDropListOrientation="mixed"
                (cdkDropListDropped)="dropInGroup($event, item)"
              >
                <div class="row row-gap-3">
                  @for (groupItem of item._listChild; track groupItem._key; let
                  i = $index) {

                  <div
                    (click)="onSelectThanhPhan(groupItem, $event)"
                    cdkDrag
                    (cdkDragStarted)="onDragStart(groupItem)"
                    class="d-flex gap-2 _component 
                                        {{ groupItem._css.flex }}
                                        {{ groupItem._css.align }}
                                       col-{{
                      thietBiHienThi === maThietBi.DESKTOP
                        ? 'lg-'
                        : thietBiHienThi === maThietBi.TABLET
                        ? 'md-'
                        : ''
                    }}{{ groupItem._css.responsive[thietBiHienThi] }}
                                        "
                  >
                    <!-- label -->
                    @if (groupItem.inputType != 'checkbox') {
                    <label
                      [style.color]="groupItem._css.label.color"
                      [style.font-size.px]="groupItem._css.label.fontSize"
                      for="{{ groupItem._key }}"
                    >
                      <i
                        class="pi pi-{{ groupItem._css.label.icon }}"
                        [style.color]="groupItem._css.label.iconColor"
                        *ngIf="groupItem._css.label.icon"
                      ></i>

                      {{ groupItem.label }}
                      <span class="text-danger" *ngIf="groupItem.isRequired"
                        >*</span
                      >
                      <code class="fw-bold text-primary fs-6 user-select-all">{{
                        groupItem._key
                      }}</code>

                      <!-- icon edit -->
                      <i
                        class="pi pi-pencil text-danger _component-icon-edit"
                        [class.selected]="groupItem._isSelected"
                      ></i>
                    </label>
                    } @if (groupItem.inputType == 'text') {
                    <input
                      pInputText
                      [placeholder]="groupItem.placeholder"
                      [style.color]="groupItem._css.content.color"
                      [style.font-size.px]="groupItem._css.content.fontSize"
                      id="{{ groupItem._key }}"
                      attr.aria-describedby="{{ groupItem._key }}-help"
                      [required]="groupItem.isRequired"
                      class="w-100"
                    />
                    }@else if (groupItem.inputType == 'number') {
                    <p-inputNumber
                      class="w-100"
                      [styleClass]="'w-100'"
                      [placeholder]="groupItem.placeholder"
                      [inputStyleClass]="'w-100'"
                      inputId="{{ groupItem._key }}"
                      [style.color]="groupItem._css.content.color"
                      [style.font-size.px]="groupItem._css.content.fontSize"
                      attr.aria-describedby="{{ groupItem._key }}-help"
                      [required]="groupItem.isRequired"
                    />
                    }@else if (groupItem.inputType == 'checkbox') {
                    <div class="d-flex {{ groupItem._css.flex }} gap-4">
                      <p-checkbox
                        id="{{ groupItem._key }}"
                        [binary]="true"
                        label="{{ groupItem.label }}"
                        name="{{ groupItem._key }}"
                        [value]="groupItem.label"
                      />
                    </div>

                    }@else if (groupItem.inputType == 'email') {
                    <input
                      [placeholder]="groupItem.placeholder"
                      type="text"
                      pInputText
                      [pattern]="emailPattern"
                      [style.color]="groupItem._css.content.color"
                      [style.font-size.px]="groupItem._css.content.fontSize"
                      id="{{ groupItem._key }}"
                      attr.aria-describedby="{{ groupItem._key }}-help"
                      [required]="groupItem.isRequired"
                      class="w-100"
                    />
                    }@else if (groupItem.inputType == 'radio') {
                    <div class="d-flex {{ groupItem._css.flex }} gap-2">
                      <div
                        *ngFor="let value of groupItem._listValueOptionOpenJSON"
                        class="d-flex {{ groupItem._css.align }} gap-2"
                      >
                        <p-radioButton
                          [inputId]="groupItem._key"
                          [(ngModel)]="groupItem._value"
                          name="{{ groupItem._key }}"
                          [value]="value"
                        />
                        <label [for]="groupItem._key">
                          {{ value }}
                        </label>
                      </div>
                    </div>
                    }@else if (groupItem.inputType == 'select') {
                    <p-dropdown
                      class="w-100"
                      [id]="groupItem._key"
                      [filter]="groupItem.isSearch"
                      [placeholder]="groupItem.placeholder"
                      [options]="groupItem._listValueOptionOpenJSON"
                      [styleClass]="'w-100'"
                      [required]="groupItem.isRequired"
                    />
                    }@else if (groupItem.inputType == 'tags') {
                    <p-chips
                      class="w-100"
                      [placeholder]="groupItem.placeholder"
                      [inputId]="groupItem._key"
                      [allowDuplicate]="groupItem.isAllowDuplicate"
                    />
                    }@else if (groupItem.inputType == 'editor') {

                    <p-editor
                      [placeholder]="groupItem.placeholder"
                      [style]="{ height: groupItem._css.height + 'px' }"
                      [style.color]="groupItem._css.content.color"
                      [style.width.%]="'100'"
                      [style.font-size.px]="groupItem._css.content.fontSize"
                      id="{{ groupItem._key }}"
                    />

                    }@else if(groupItem.inputType == 'file'){

                    <p-fileUpload
                      class="w-100"
                      [multiple]="groupItem.multiple"
                      accept="{{ groupItem.acceptFileExtensions }}"
                      maxFileSize="{{ groupItem.maxFileSize }}"
                    >
                    </p-fileUpload>
                    }@else if(groupItem.inputType == 'textarea'){

                    <textarea rows="5" cols="30" pInputTextarea> </textarea>

                    }
                  </div>

                  }
                </div>
              </div>
            </section>
          </ng-container>
          }
          <!-- end @for -->
        </div>
        <!-- </div> -->
      </div>
    </div>
  </div>
</div>
